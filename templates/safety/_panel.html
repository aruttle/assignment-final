{% load humanize %}
{% if error %}
  <div class="alert alert-warning mb-0">{{ error }}</div>
{% else %}
  <div class="card">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">Safety check</h5>
        <span class="badge {{ badge }}">{{ label }}</span>
      </div>

      <div class="small text-muted mb-2">
        Lat {{ lat|floatformat:3 }}, Lon {{ lon|floatformat:3 }}
      </div>

      <div class="row g-3">
        <div class="col-md-6">
          <ul class="list-unstyled mb-0">
            <li>Wind: <strong>{{ wind_ms|floatformat:1 }} m/s</strong></li>
            <li>Gusts: <strong>{{ gust_ms|floatformat:1 }} m/s</strong></li>
            <li>Precipitation chance (hour): <strong>{{ precip_prob }}%</strong></li>
          </ul>
        </div>

        <div class="col-md-6">
          <div class="d-flex justify-content-between align-items-center">
            <div class="fw-semibold">Tides</div>
            {% if next_tide %}
              <div class="small text-muted">
                Next: {{ next_tide.type|title }}
                at {{ next_tide.time|date:"D, M j H:i" }}
                {% if next_tide.height is not None %}
                  ({{ next_tide.height|floatformat:2 }} m)
                {% endif %}
              </div>
            {% endif %}
          </div>

          {% if tide_list %}
            <ul class="list-group list-group-flush mt-1">
              {% for t in tide_list %}
                <li class="list-group-item px-0 d-flex justify-content-between align-items-center">
                  <div>
                    {% if t.type == "high" %}↑{% else %}↓{% endif %}
                    <span class="me-1">{{ t.type|title }}</span>
                    <span class="text-muted">{{ t.time|date:"D, M j H:i" }}</span>
                    <span class="text-muted small ms-1">({{ t.time|naturaltime }})</span>
                  </div>
                  <div class="fw-semibold">
                    {% if t.height is not None %}{{ t.height|floatformat:2 }} m{% else %}—{% endif %}
                  </div>
                </li>
              {% endfor %}
            </ul>
            <div class="small text-muted mt-1">Source: modelled predictions (Stormglass). Always check local notices/charts.</div>
          {% else %}
            <div class="text-muted small">Tide data unavailable.</div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endif %}
